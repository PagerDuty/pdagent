
## Build Agent

Build deb/rpm as documented in `build-linux/howto.txt`.

For the rpm build, remember to copy the rpm out of the build VM:

    [vagrant@localhost build-linux]$ cp target/pdagent-0.1-1.noarch.rpm /vagrant/build-linux/target/



## Zabbix VM Setup

- Create the Zabbix VM:

        vagrant up agent-zabbix-ubuntu1004  # or other zabbix vm

- Get the public IP of the VM:

        vagrant ssh agent-zabbix-ubuntu1004 -c "ip addr show eth1"

- Enter the IP in your browser - this should bring up the Zabbix web UI

- Login: admin / zabbix



## Install Agent

Install the agent in the VM:

    vagrant ssh agent-zabbix-ubuntu1004  # or other zabbix vm

in Ubuntu:

    sudo dpkg -i /vagrant/build-linux/target/pdagent_0.1_all.deb

in CentOS:

    sudo rpm -i /vagrant/build-linux/target/pdagent-0.1-1.noarch.rpm


## Zabbix Agent Setup

- Get alert scripts path from your Zabbix server config. For example:

        [vagrant@localhost zabbix]$ grep AlertScriptsPath /etc/zabbix/zabbix_server.conf
        AlertScriptsPath=/etc/zabbix/alert.d

    > If this is not set, see the Zabbix manual for the default directory e.g.
    > for Zabbix 2.0, this is documented here:
    > https://www.zabbix.com/documentation/2.0/manual/appendix/config/zabbix_server


- Make a soft link to `pd-zabbix` in this directory

        cd /etc/zabbix/alert.d  # use the correct directory here
        sudo ln -s /usr/bin/pd-zabbix


- Follow the PagerDuty Zabbix Integration Guide from step 6, with the following changes:

    Step 11: Enter `pd-zabbix` for Script name

    > Note: the guide is here:
    > http://www.pagerduty.com/docs/guides/zabbix-integration-guide/

    - FIXME: guide may be simpler if we skip creating PD user & user group
    - FIXME: guide may be simpler if create the group first, especially for
      Zabbix v2


## Testing

- Under Configuration > Hosts, enable the "Zabbix server" host. (Click on "Not
  Monitored" under Status)

- Reboot the Zabbix VM:

        [vagrant@localhost zabbix]$ sudo reboot

    > Note: the VM needs to be up for at least 10 mins after you enable checks
    > since the Zabbix host restart check runs only once every 10 mins.


