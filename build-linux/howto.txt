
# Linux Build Instructions

These instructions assume you're running this on a Mac with Vagrant installed,
and that the project directory ends up mounted in the VM at `/vagrant`. (this
should happen automatically)

## One-time setup:

    cd /my/agent/workspace
    gpg --homedir=build-linux/gnupg --gen-key
    gpg --export --armor >build-linux/gnupg/build-GPG-KEY

## Ubuntu

Building the .deb:

    scons local-repo \
        gpg-home=build-linux/gnupg \
        virt=agent-minimal-ubuntu1204

Install & test the .deb:

    vagrant ssh agent-minimal-ubuntu1004 # or agent-minimal-ubuntu1204

    sudo apt-key add /vagrant/build-linux/gnupg/build-GPG-KEY
    sudo sh -c 'echo "deb file:///vagrant/target deb/" \
      >/etc/apt/sources.list.d/pdagent.list'
    sudo apt-get update
    sudo apt-get install pdagent

    sudo service pdagent status
    which pd-send
    python -c "import pdagent; print pdagent.__file__"

Uninstall & test cleanup:

    sudo apt-get --yes remove pdagent

    # rerun the test commands to ensure files are gone


## CentOS / RHEL

Building the .rpm:

    scons local-repo \
        gpg-home=/gpg/path/used/earlier \
        virt=agent-minimal-centos65

Install & test the .rpm:

    vagrant ssh agent-minimal-centos65

    sudo sh -c 'cat >/etc/yum.repos.d/pdagent.repo <<EOF
[pdagent]
name=PDAgent
baseurl=file:///vagrant/target/rpm
enabled=1
gpgcheck=1
gpgkey=file:///vagrant/build-linux/gnupg/build-GPG-KEY
EOF'
    sudo yum install pdagent

    sudo service pdagent status
    which pd-send
    python -c "import pdagent; print pdagent.__file__"

Uninstall & test cleanup:

    sudo yum remove --yes pdagent

    # rerun the test commands to ensure files are gone

